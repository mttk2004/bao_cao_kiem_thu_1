% Định nghĩa một kiểu cột mới cho phép xuống dòng và canh lề trái
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\section{Review file \texttt{PasswordEncryptionService.java}}

Bảng dưới đây tổng hợp các vấn đề được phát hiện trong file \texttt{PasswordEncryptionService.java}.


\begin{longtable}{L{1.5cm} L{3.5cm} c L{4cm} L{4cm}}
    \caption{Bảng review chi tiết cho file \texttt{PasswordEncryptionService.java}} \label{tab:review_PasswordEncryptionService_java} \\

    \toprule
    \textbf{Check code} & \textbf{Check code Description} & \textbf{Line} & \textbf{Comment} & \textbf{Suggestion / Fix} \\
    \midrule
    \endfirsthead

    \multicolumn{5}{c}%
    {{\tablename\ \thetable{} -- tiếp theo}} \\
    \toprule
    \textbf{Check code} & \textbf{Check code Description} & \textbf{Line} & \textbf{Comment} & \textbf{Suggestion / Fix} \\
    \midrule
    \endhead

    \bottomrule
    \endfoot

    \endlastfoot
    15 & Is every method parameter value checked before being used? & 12 & Method authenticate() không kiểm tra attemptedPassword có null hay empty & Thêm validation: if (attemptedPassword == null || attemptedPassword.isEmpty()) \\
    \midrule
    15 & Is every method parameter value checked before being used? & 12 & Method authenticate() không kiểm tra encryptedPassword và salt có null & Thêm kiểm tra if (encryptedPassword == null || salt == null) \\
    \midrule
    15 & Is every method parameter value checked before being used? & 21 & Method getEncryptedPassword() không validate password và salt parameters & Kiểm tra password != null \&\& !password.isEmpty() \&\& salt != null \\
    \midrule
    46 & Does every attribute,variable or constant declaration have a comment? & 25 & PBKDF2WithHmacSHA1 algorithm đã deprecated, nên dùng SHA-256 hoặc SHA-512 & Đổi sang "PBKDF2WithHmacSHA256" cho security tốt hơn \\
    \midrule
    46 & Does every attribute,variable or constant declaration have a comment? & 42 & Salt size 8 bytes có thể nhỏ theo modern security standards & Tăng lên 16 bytes (128 bit) hoặc 32 bytes (256 bit) \\
    \midrule
    10 & Are there variables that should be constants? & 25 & Các magic numbers nên được define thành constants & private static final String ALGORITHM = "PBKDF2WithHmacSHA256"; \\
    \midrule
    10 & Are there variables that should be constants? & 27 & derivedKeyLength và iterations nên là class constants & private static final int DERIVED\_KEY\_LENGTH = 256; private static final int ITERATIONS = 100000; \\
    \midrule
    10 & Are there variables that should be constants? & 42 & Salt length nên là constant thay vì magic number & private static final int SALT\_LENGTH = 16; \\
    \midrule
    46 & Does every attribute,variable or constant declaration have a comment? & 31 & Iteration count 20000 có thể thấp theo modern standards (OWASP khuyến nghị \textgreater{}= 100000) & Tăng lên ít nhất 100000 iterations \\
    \midrule
    45 & Does every method, class, and file have an appropriate header comment? & 10 & Class thiếu header comment về security best practices và usage & Thêm Javadoc comment về thread safety, algorithm choices và security notes \\
    \midrule
    37 & Are all exceptions handled appropriately? & 12 & Methods throw checked exceptions nhưng không có recovery mechanism & Consider wrapping trong runtime exception với meaningful messages \\
    \midrule
    19 & For every object or array reference: Is the value certain to be non-null? & 15 & Không clear password char array sau khi sử dụng, có thể remain in memory & Clear password.toCharArray() sau khi tạo KeySpec \\
    \midrule
    4 & Does every method return the correct value at every method return point? & 18 & authenticate() có thể return false positive nếu cả hai arrays đều null & Thêm explicit null checks trước Arrays.equals() \\
    \midrule
    37 & Are all exceptions handled appropriately? & 39 & generateSalt() có thể fail nhưng không có fallback mechanism & Implement fallback hoặc retry logic khi SecureRandom fails \\
    \midrule
    46 & Does every attribute,variable or constant declaration have a comment? & 39 & SHA1PRNG algorithm có thể không available trên all platforms & Sử dụng SecureRandom.getInstanceStrong() hoặc new SecureRandom() \\
    \midrule
    16 & Does each class have an appropriate constructor? & 10 & Class không có explicit constructor, có thể cần singleton pattern cho performance & Consider singleton pattern vì cryptographic operations expensive \\
\end{longtable}
